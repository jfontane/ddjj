{% extends "@JubilacionesDeclaraciones/layout-organismo.html.twig" %}
{% block pageid 'ddjj' %}

{% block header %}
<ul class="navbar-nav mr-auto">
  <li class="nav-item">
    <a class="nav-link" href="{{ path('principal_logueado') }}">Home <span class="sr-only">(current)</span></a>
  </li>
  <li class="nav-item ">
    <a class="nav-link" href="{{ path('organismo_organismo_listar') }}">Organismo <span class="sr-only">(current)</span></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ path('organismo_convenio_cuota_listar') }}">Convenios</a>
  </li>
  <li class="nav-item active">
    <a class="nav-link" href="{{ path('organismo_declaracion_listar') }}">Declaraciones</a>
  </li>
</ul>
<ul class="list-inline custom-icon-middle">
  <li class="list-inline-item">
    <a href="#" class="dropdown-toggle" id="dropdownMenuLinkPerson" data-toggle="dropdown"
    aria-haspopup="true"
    aria-expanded="false" title="Usuario logeado"><i class="material-icons">person</i></a>
    <div class="dropdown-menu custom-dropdown-menu-right" aria-labelledby="dropdownMenuLinkPerson">
      <a class="dropdown-item" href="{{ path('organismo_usuario_editar') }}">Cambiar Contraseña</a>
    </div>
  </li>

  <li class="list-inline-item"><a href="{{ path('logout') }}" title="Salir"><i class="material-icons">exit_to_app</i></a>
  </li>

</ul>
{% endblock %}

{% block body %}
        {# CONTENIDO ORIGINAL DEL ARCHIVO Y SIN LAS ETIQUETAS <html><body> � </body></html> #}
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ path('principal_logueado') }}">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Declaraciones</li>
            </ol>
        </nav>

        <!-- MENSAJES FLASH ADMIN AQUÍ (utilizar <div class=”flash_admin”> </div>) -->
        <div class="alert alert-warning" role="alert">
            {% for mensaje in app.session.flashbag.get('warn') %}
                <p class="warn">{{ mensaje }}</p>
            {% endfor %}
        </div>

        <div class="grid_16">
            <table class="table">
                <thead class="thead-dark">
                    <tr>
                        <th>Periodo</th>
                        <th>T.Liq.</th>
                        <th>F.Entrega</th>
                        <th>F.Ingreso</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% if pagination %}
                        {% for declaracion in pagination.items %}
                            <tr>
                                <td>
                                    {{ declaracion.periodoAnio }}/{{ declaracion.periodoMes }}
                                </td>
                                <td>{{ declaracion.tipoLiquidacion }}</td>
                                <td>
                                    {{  declaracion.fechaEntrega is empty ? "" : declaracion.fechaEntrega | date('Y-m-d H:i') }}
                                </td>
                                <td>
                                    {{  declaracion.fechaIngreso is empty ? "" : declaracion.fechaIngreso | date('Y-m-d H:i') }}
                                </td>
                                <td>{{ declaracion.estado }}</td>
                                <td>

                                    {% if declaracion.estado == 'Pendiente' or declaracion.estado == 'Rechazada'%}
                                        <a href="{{ path ('organismo_declaracion_ver',{'id' : declaracion.id }) }}">Ver</a>&nbsp;&nbsp;
                                        <a href="{{ path ('organismo_declaracion_editar',{'id' : declaracion.id }) }}">Editar</a>&nbsp;&nbsp;
                                        <a href="" id="btn_borrar" data-id="{{ declaracion.id }}">Borrar</a>
                                    {% elseif declaracion.estado == 'Procesando' %}
                                        <a href="{{ path ('organismo_declaracion_ver',{'id' : declaracion.id }) }}">Ver</a>&nbsp;&nbsp;
                                    {% endif %}
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="7">No existe ninguna Declaracion Jurada.</td>
                            </tr>
                        {% endfor %}
                    {% else %}
                    <td colspan="6">No existen Declaraciones Juradas.</td>
                {% endif %}
                </tbody>
            </table>
            <div>
                <div style="float:left">
                    <a href="{{path('organismo_declaracion_nuevo')}}"> Nuevo </a>&nbsp;
                </div>
                <div style="float:right">
                    <a href="{{path('organismo_declaracion_listar_pdf')}}" target="_blank"> Imprimir </a>
                </div>
            </div>
            <br><br><br>
            <br>
            {% if pagination %}
                <div class="navigation">
                    {{ knp_pagination_render(pagination) }}
                </div>
            {% endif %}
        </div>

    {% endblock %}
    {% block javascripts %}
        {{ parent() }}
        <script>
            $(document).ready(function () {
                $('a[id=btn_borrar]').on('click', function () {
                    event.preventDefault();
                    id = $(this).data("id");
                    //var url = "../admin/declaracion/listar";
                    var url = "./borrar/" + id;
                    if (confirm('Esta seguro de Eliminar la Declaracion Jurada??')) {
                        $(location).attr('href', url);
                    }
                });
            });
        </script>

    {% endblock %}
